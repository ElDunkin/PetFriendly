<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Animales en Permanencia</title>
    <link rel="stylesheet" href="/static/css/generic.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body class="bg-light">
    <header>
        <div class="logo">
        <nav class="menu">
            
            <ul>
                <li><a href="/dashboard_administrador">Dashboard</a></li>
                <li><a href="/registro_usuarios">Gestion Usuarios</a></li>
                <li><a href="/registro_paciente_animal">Gestion Paciente</a></li>
                <li><a href="/gestion_insumos">Gestion Insumos</a></li>
                <li><a href="/medicamento">Gestion Medicamentos</a></li>
            </ul>

            <div class="btn-group">
                <a href="{{ url_for('rutas_login.login') }}" class="btn-cupo"> Cerrar Sesi贸n</a>
            </div>
        </nav>
    </header>

    <div class="container mt-5">
        <h2 class="mb-4 text-center">Animales en Permanencia</h2>

        {% if animales %}
        <table class="table table-striped table-bordered text-center align-middle">
            <thead class="table-dark">
            <tr>
                <th>C贸digo</th>
                <th>Foto</th>
                <th>Nombre Temporal</th>
                <th>Edad</th>
                <th>Sexo</th>
                <th>Especie</th>
                <th>Raza</th>
                <th>Tama帽o</th>
                <th>Condici贸n F铆sica</th>
                <th>Ubicaci贸n del Rescate</th>
                <th>Fecha de Ingreso</th>
                <th>Acci贸n</th>
                <th>Registro detallado</th>
            </tr>
            </thead>
            <tbody>
            {% for animal in animales %}
                <tr>
                <td>{{ animal.codigo }}</td>
                <td>
                    
                    <img src="{{ url_for('static', filename='img/uploads/' ~ animal.foto_url) }}"
                    alt="Foto de {{ animal.nombre_temporal }}" 
                    width="120" height="120" class="img-thumbnail">
                </td>
                <td>{{ animal.nombre_temporal }}</td>
                <td>{{ animal.edad }}</td>
                <td>{{ animal.sexo }}</td>
                <td>{{ animal.especie }}</td>
                <td>{{ animal.raza }}</td>
                <td>{{ animal.tamanio }}</td>
                <td>{{ animal.condicion_fisica }}</td>
                <td>{{ animal.ubicacion_rescate }}</td>
                <td>{{ animal.fecha_ingreso }}</td>
                <td>
                    
                    {% if animal.estado == "En permanencia" %}
                    <span class="badge bg-success">En permanencia</span>
                    {% elif animal.estado == "Adoptado" %}
                    <span class="badge bg-light text-dark">Adoptado</span>
                    {% elif animal.estado == "Trasladado" %}
                    <span class="badge bg-info text-dark">Trasladado</span>
                    {% elif animal.estado == "Fallecido" %}
                    <span class="badge bg-danger">Fallecido</span>
                    {% endif %}
                
                </td>
                <td>
                    {% if animal.estado == "En permanencia" %}
                    <button class="btn btn-primary" 
                            data-bs-toggle="modal"
                            data-bs-target="#registrarPermanenciaModal{{ animal.id_rescatado }}">
                                Permanencia
                    </button>
                    <br>
                    <br>
                    <button class="btn btn-danger btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#modal_salida_{{ animal.id_rescatado }}">
                                Salida
                    </button>
                    {% else %}
                    <button class="btn btn-secondary" disabled>
                                permanencia
                    </button>
                    <button class="btn btn-danger btn-sm" disabled>
                                Salida
                    </button>
                    {% endif %}
                    <button class="btn btn-info"
                            data-bs-toggle="modal"
                            data-bs-target="#modal_Historial_{{ animal.id_rescatado }}">
                                Historial
                    </button>

                </td>
                </tr>
                {% include "modals/modal_registrar_permanencia.html" %}
                {% include "modals/modal_registrar_salida.html" %}
            {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
<nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">

        {% if page > 1 %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('rutas_usuarios.listar_usuarios', page=page-1) }}">Anterior</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">Anterior</span>
        </li>
        {% endif %}

        {% set page_size = 10 %}
        {% set start_page = ((page - 1) // page_size) * page_size + 1 %}
        {% set end_page = [start_page + page_size - 1, total_pages] | min %}

        {# ---- RANGO DE PGINAS MOSTRADAS ---- #}
        {% for page_num in range(start_page, end_page + 1) %}
        <li class="page-item {% if page_num == page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('rutas_usuarios.listar_usuarios', page=page_num) }}">{{ page_num }}</a>
        </li>
        {% endfor %}

        {% if page < total_pages %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('rutas_usuarios.listar_usuarios', page=page+1) }}">Siguiente</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">Siguiente</span>
        </li>
        {% endif %}
    </ul>
</nav>

        {% else %}
        <p class="text-center text-muted">No hay animales registrados en permanencia.</p>
        {% endif %}
        {% include "modals/modal_historial_permanencia.html" %}
    </div>
    <footer>
        <div>
            Copyright 漏 2025 Developed by Trio Imperial co.
        </div>

        <div>
            Powered by Petfriendly
        </div>
    </footer>
    {% if request.args.get("abrir_historial") and request.args.get("id_rescatado") %}
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var id = "{{ request.args.get('id_rescatado') }}";
            var modal = new bootstrap.Modal(document.getElementById("modal_Historial_" + id));
            modal.show();
        });
    </script>
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/historial_permanencia.js"></script>
</body>
</html>