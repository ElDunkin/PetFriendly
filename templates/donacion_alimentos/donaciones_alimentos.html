<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registrar DonaciÃ³n de Medicamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/generic.css">
    <link rel="stylesheet" href="/static/css/registro_usuarios.css">
</head>
<body>
    <header>
        <div class="logo">
        <nav class="menu">
            
            <ul>
                <li><a href="/dashboard_administrador">Dashboard</a></li>
                <li><a href="/registro_usuarios">Gestion Usuarios</a></li>
                <li><a href="/registro_paciente_animal">Gestion Paciente</a></li>
                <li><a href="/gestion_insumos">Gestion Insumos</a></li>
                <li><a href="/medicamento">Gestion Medicamentos</a></li>
            </ul>

            <div class="btn-group">
                <a href="{{ url_for('rutas_login.login') }}" class="btn-cupo">ðŸ”’ Cerrar SesiÃ³n</a>
            </div>
        </nav>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} mt-2">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

<form method="POST">
    {{ form.hidden_tag() }}

    <div>
        {{ form.fecha_recepcion.label }}
        {{ form.fecha_recepcion(type="date", max=today) }}
        {% for error in form.fecha_recepcion.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div>
        {{ form.nombre_donante.label }}
        {{ form.nombre_donante }}
        {% for error in form.nombre_donante.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div>
        {{ form.tipo_alimento.label }}
        {{ form.tipo_alimento(id="tipo_alimento") }}
        {% for error in form.tipo_alimento.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div id="otros-container" style="display: none;">
        {{ form.otros.label }}
        {{ form.otros(id="otros") }}
        {% if form.otros.errors %}
            <span style="color:red">{{ form.otros.errors[0] }}</span>
        {% endif %}
    </div>

    <div>
        {{ form.cantidad.label }}
        {{ form.cantidad }}
        {% for error in form.cantidad.errors %}
        <div class="text-danger small">{{ error }}</div>
        {% endfor %}
    </div>

    <div>
        {{ form.unidad.label }}
        {{ form.unidad }}
        {% for error in form.unidad.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div>
        {{ form.fecha_vencimiento.label }}
        {{ form.fecha_vencimiento(type="date", min=today) }}
        {% for error in form.fecha_vencimiento.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <div>
        {{ form.destino.label }}
        {{ form.destino(id="destino") }}
        {% for error in form.destino.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>

    <!-- Campo Caso EspecÃ­fico -->
    <div id="caso-especifico-container" style="display: none;">
        {{ form.caso_especifico.label }}
        {{ form.caso_especifico(id="caso_especifico") }}
        {% if form.caso_especifico.errors %}
            <span style="color:red">{{ form.caso_especifico.errors[0] }}</span>
        {% endif %}
    </div>

    <div>
        {{ form.observaciones.label }}
        {{ form.observaciones }}
        {% for error in form.observaciones.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %} 
    </div>
    <br>
    <div>
        {{ form.submit }}
    </div>
    <div class="mt-3 text-center">
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#historialModal">
        Ver Historial de Donaciones
    </button>
</div>
<div class="modal fade" id="historialModal" tabindex="-1" aria-labelledby="historialModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content" id="modalContent">
        <div class="modal-body text-center">
            <p>Cargando historial...</p>
        </div>
    </div>
  </div>
</div>
</form>

<footer>
        <div>
            Copyright Â© 2025 Developed by Trio Imperial co.
        </div>

        <div>
            Powered by Petfriendly
        </div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const destinoSelect = document.querySelector("#destino");
    const casoEspecificoContainer = document.querySelector("#caso-especifico-container");
    const casoEspecificoField = document.querySelector("#caso_especifico");

    const tipoAlimento = document.querySelector("#tipo_alimento");
    const otrosContainer = document.querySelector("#otros-container");

    const fechaRecepcion = document.querySelector("#fecha_recepcion");
    const fechaVencimiento = document.querySelector("#fecha_vencimiento");

    function toggleCasoEspecifico() {
        if (destinoSelect.value === "Caso especifico") {
            casoEspecificoContainer.style.display = "block";
            casoEspecificoField.disabled = false;
        } else {
            casoEspecificoContainer.style.display = "none";
            casoEspecificoField.disabled = true;
            casoEspecificoField.value = "";
        }
    }

    function toggleOtros() {
        if (tipoAlimento.value === "Otros") {
            otrosContainer.style.display = "block";
        } else {
            otrosContainer.style.display = "none";
        }
    }

    fechaRecepcion.addEventListener("change", function() {
        if (fechaRecepcion.value) {
            let recepcionDate = new Date(fechaRecepcion.value);
            recepcionDate.setDate(recepcionDate.getDate() + 1); // +1 dÃ­a
            fechaVencimiento.min = recepcionDate.toISOString().split("T")[0];
        }
    });

    destinoSelect.addEventListener("change", toggleCasoEspecifico);
    tipoAlimento.addEventListener("change", toggleOtros);

    // Ejecutar al cargar la pÃ¡gina, por si hay valores previos
    toggleCasoEspecifico();
    toggleOtros();
});

document.getElementById('historialModal').addEventListener('show.bs.modal', function () {
    fetch("{{ url_for('rutas_alimentos.historial') }}")  // ðŸ‘ˆ endpoint que renderiza historial.html
        .then(response => response.text())
        .then(html => {
            document.getElementById('modalContent').innerHTML = html;
        });
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>    
</body>
</html>