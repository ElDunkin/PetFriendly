<link rel="stylesheet" href="/static/css/citas.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Modal -->
<div class="modal fade" id="modalNuevaCita" tabindex="-1" aria-labelledby="modalNuevaCitaLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content modal-cita-content">

      <div class="modal-header modal-cita-header">
        <h4 class="modal-title" id="modalNuevaCitaLabel">
          <i class="fas fa-calendar-plus text-primary"></i>
          Registrar Nueva Cita
        </h4>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body modal-cita-body">
        <form action="{{ url_for('rutas_citas.citas') }}" method="POST" id="formNuevaCita">

          <!-- Documento del Propietario -->
          <div class="form-group-cita">
            <label class="form-label-cita">
              <i class="fas fa-id-card text-primary"></i>
              Documento del Propietario
            </label>
            <div class="input-group-cita">
              <span class="input-group-text"><i class="fas fa-user"></i></span>
              <input type="text" id="documento" name="numero_documento" class="form-control form-control-cita"
                     placeholder="Ingresa el nÃºmero de documento" required>
            </div>
            <div id="mensaje-documento" class="error-message"></div>
          </div>

          <!-- Mascota -->
          <div class="form-group-cita">
            <label class="form-label-cita">
              <i class="fas fa-paw text-success"></i>
              Mascota
            </label>
            <div class="input-group-cita">
              <span class="input-group-text"><i class="fas fa-heart"></i></span>
              <select name="id_paciente" id="select-mascota" class="form-select form-select-cita" required disabled>
                <option value="">-- Selecciona la mascota --</option>
              </select>
            </div>
          </div>

          <!-- Fecha y Hora -->
          <div class="row">
            <div class="col-md-6">
              <div class="form-group-cita">
                <label class="form-label-cita">
                  <i class="fas fa-calendar text-info"></i>
                  Fecha
                </label>
                <div class="input-group-cita">
                  <span class="input-group-text"><i class="fas fa-calendar-day"></i></span>
                  <input type="date" name="fecha" class="form-control form-control-cita" required>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group-cita">
                <label class="form-label-cita">
                  <i class="fas fa-clock text-warning"></i>
                  Hora
                </label>
                <div class="input-group-cita">
                  <span class="input-group-text"><i class="fas fa-clock"></i></span>
                  <input type="time" name="hora" class="form-control form-control-cita" required>
                </div>
              </div>
            </div>
          </div>

          <!-- Motivo -->
          <div class="form-group-cita">
            <label class="form-label-cita">
              <i class="fas fa-notes-medical text-secondary"></i>
              Motivo de la Cita
            </label>
            <div class="input-group-cita">
              <span class="input-group-text"><i class="fas fa-comment-medical"></i></span>
              <textarea name="motivo" class="form-control form-control-cita" rows="3"
                        placeholder="Describe el motivo de la cita veterinaria..." required></textarea>
            </div>
          </div>

          <!-- Estado -->
          <div class="form-group-cita">
            <label class="form-label-cita">
              <i class="fas fa-info-circle text-muted"></i>
              Estado Inicial
            </label>
            <div class="input-group-cita">
              <span class="input-group-text"><i class="fas fa-flag"></i></span>
              <select name="estado" class="form-select form-select-cita">
                <option value="Activa">Activa</option>
                <option value="Cancelada">Cancelada</option>
                <option value="Atendida">Atendida</option>
              </select>
            </div>
          </div>

          <!-- Botones -->
          <div class="modal-cita-footer">
            <button type="button" class="btn btn-cancelar-cita" data-bs-dismiss="modal">
              <i class="fas fa-times"></i> Cancelar
            </button>
            <button type="submit" class="btn btn-registrar-cita">
              <i class="fas fa-save"></i> Registrar Cita
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Script -->
<script>
  // llenar select de mascotas por documento
  document.addEventListener('DOMContentLoaded', function(){
    const documentoInput = document.getElementById('documento');
    const selectMascota = document.getElementById('select-mascota');
    const mensaje = document.getElementById('mensaje-documento');

    documentoInput.addEventListener('blur', function() {
      const documento = this.value.trim();
      selectMascota.innerHTML = '<option value="">-- Selecciona la mascota --</option>';
      selectMascota.disabled = true;
      mensaje.textContent = '';

      if (!documento) return;

      fetch(`/buscar_mascotas/${encodeURIComponent(documento)}`)
        .then(r => r.json())
        .then(data => {
          if (data.error) {
            mensaje.textContent = data.error;
            return;
          }
          if (!data.mascotas || data.mascotas.length === 0) {
            mensaje.textContent = 'Este propietario no tiene animales registrados.';
            return;
          }
          data.mascotas.forEach(m => {
            const opt = document.createElement('option');
            opt.value = m.id_paciente;
            opt.textContent = m.nombre_paciente;
            selectMascota.appendChild(opt);
          });
          selectMascota.disabled = false;
        })
        .catch(() => { mensaje.textContent = 'Error al consultar mascotas.'; });
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


