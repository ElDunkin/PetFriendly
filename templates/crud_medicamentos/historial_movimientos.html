{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="/static/css/generic.css">

<header>
  <div class="logo"></div>
  <nav class="menu">
    <ul>
      <li><a href="/dashboard_administrador">Dashboard</a></li>
      <li><a href="/medicamento">Medicamentos</a></li>
    </ul>
  </nav>
</header>

<main>
  <div class="container mt-4">
    <h2>Historial de movimientos</h2>

    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Tipo</th>
            <th>Responsable</th>
            <th>Motivo</th>
            <th>Cantidad</th>
            <th>Observación</th>
          </tr>
        </thead>
        <tbody>
          {% if movimientos and movimientos|length > 0 %}
            {% for mv in movimientos %}
              <tr>
                <td>{{ mv.fecha }}</td>
                <td>{{ mv.tipo }}</td>
                <td>{{ mv.responsable }}</td>
                <td>{{ mv.motivo }}</td>
                <td>{{ mv.cantidad }}</td>
                <td>{{ mv.observacion }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" class="text-center">No hay movimientos registrados</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <nav aria-label="Page navigation" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if page > 1 %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('rutas_medicamentos.historial_movimientos', id_medicamento=id_medicamento, page=page-1) }}">Anterior</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Anterior</span></li>
        {% endif %}

        {% set page_size = 10 %}
        {% set start_page = ((page - 1) // page_size) * page_size + 1 %}
        {% set end_page = [start_page + page_size - 1, total_pages] | min %}

        {% for page_num in range(start_page, end_page + 1) %}
          <li class="page-item {% if page_num == page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('rutas_medicamentos.historial_movimientos', id_medicamento=id_medicamento, page=page_num) }}">{{ page_num }}</a>
          </li>
        {% endfor %}

        {% if page < total_pages %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('rutas_medicamentos.historial_movimientos', id_medicamento=id_medicamento, page=page+1) }}">Siguiente</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
        {% endif %}
      </ul>
    </nav>

    <div class="mt-3">
      <a href="{{ url_for('rutas_medicamentos.listar_medicamentos') }}" class="btn btn-secondary">Volver</a>
    </div>
  </div>
</main>
{% endblock %}
