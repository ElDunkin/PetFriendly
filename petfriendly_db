CREATE DATABASE `petfriendly_db`;

USE `petfriendly_db`;

CREATE TABLE `rol` (
    `id_rol` INT AUTO_INCREMENT PRIMARY KEY,
    `nombre_rol` ENUM('Administrador','Medico_Veterinario','Cliente') NOT NULL
);

CREATE TABLE `usuarios` (
    `numero_documento` INT PRIMARY KEY,
    `nombre_usuario` VARCHAR(100) NOT NULL,
    `apellido_usuario` VARCHAR(100) NOT NULL,
    `tipo_documento_usuario` ENUM('CC','CE','PASAPORTE','PPT') NOT NULL,
    `correo_electronico_usuario` VARCHAR(200) NOT NULL UNIQUE,
    `telefono` VARCHAR(20) NOT NULL,
    `id_rol` INT,
    `contrasena` VARCHAR(255) NOT NULL,
    FOREIGN KEY (`id_rol`) REFERENCES `rol`(`id_rol`)
);

CREATE TABLE `paciente_animal` (
    `id_paciente` INT AUTO_INCREMENT PRIMARY KEY,
    `nombre_paciente` VARCHAR(100) NOT NULL,
    `especie_paciente` ENUM ('Perro','Gato') NOT NULL,
    `raza_paciente` VARCHAR(100) NOT NULL,
    `sexo_paciente` ENUM ('Macho','Hembra') NOT NULL,
    `peso_paciente` DECIMAL(5,2) NOT NULL,
    `color_pelaje_paciente` VARCHAR(100) NOT NULL,
    `fecha_nacimiento_paciente` DATE DEFAULT NULL,
    `edad_estimada_paciente` INT DEFAULT NULL,
    `foto_paciente` VARCHAR(255) DEFAULT NULL,
    `rescatado` BOOLEAN NOT NULL DEFAULT FALSE,
    `adoptado` BOOLEAN NOT NULL DEFAULT FALSE,
    `numero_documento` INT DEFAULT NULL,
    FOREIGN KEY (`numero_documento`) REFERENCES `usuarios`(`numero_documento`)
);

INSERT INTO `rol` (`nombre_rol`) VALUES ('Administrador'),('Medico_Veterinario'),('Cliente');


CREATE TABLE `consultas` (
    `id_consulta` INT AUTO_INCREMENT PRIMARY KEY,
    `id_paciente` INT,
    `fecha_consulta` DATE NOT NULL,
    `hora_consulta` TIME NOT NULL,
    `motivo_consulta` TEXT NOT NULL,
    `diagnostico` TEXT NOT NULL,
    `tratamiento` TEXT,
    `medicamentos` TEXT,
    `observaciones` TEXT,
    `firma` VARCHAR(255) NOT NULL,
    `numero_documento` INT,
    FOREIGN KEY (`id_paciente`) REFERENCES `paciente_animal`(`id_paciente`),
    FOREIGN KEY (`numero_documento`) REFERENCES `usuarios`(`numero_documento`)
);

CREATE TABLE `archivos_consulta` (
    `id_archivo` INT AUTO_INCREMENT PRIMARY KEY,
    `id_consulta` INT,
    `nombre_archivo` VARCHAR(255),
    FOREIGN KEY (`id_consulta`) REFERENCES `consultas`(`id_consulta`)
);

CREATE TABLE `insumo` (
        `id` INT AUTO_INCREMENT PRIMARY KEY,
        `nombre` VARCHAR(100) NOT NULL,
        `cantidad_inicial` INT NOT NULL,
        `unidad_medida` VARCHAR(50) NOT NULL,
        `proveedor` VARCHAR(100) NOT NULL,
        `fecha_ingreso` DATE NOT NULL,
        `fecha_vencimiento` DATE,
        `tipo_insumo` VARCHAR(50) NOT NULL,
        `observaciones` TEXT
    );

    CREATE TABLE `movimiento_insumo` (
        `id` INT AUTO_INCREMENT PRIMARY KEY,
        `insumo_id` INT NOT NULL,
        `tipo_movimiento` ENUM('entrada','salida') NOT NULL,
        `responsable` VARCHAR(100),
        `cantidad` INT NOT NULL,
        `fecha` DATE NOT NULL,
        `motivo` VARCHAR(100),
        `observacion` TEXT,
        FOREIGN KEY (`insumo_id`) REFERENCES insumo(`id`)
    );

CREATE TABLE `citas` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `nombre_dueno` VARCHAR(100),
    `nombre_mascota` VARCHAR(100),
    `fecha` DATE,
    `hora` TIME,
    `motivo` TEXT
);

CREATE TABLE `jornadas` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `nombre_evento` VARCHAR(100) NOT NULL,
    `fecha` DATE NOT NULL,
    `lugar` VARCHAR(100) NOT NULL,
    `descripcion` TEXT
);


CREATE VIEW usuarios_por_rol AS 
SELECT u.numero_documento, 
        u.nombre_usuario, 
        u.apellido_usuario,
        u.tipo_documento_usuario, 
        u.correo_electronico_usuario,
        u.telefono, 
        r.nombre_rol
    FROM usuarios u
    JOIN rol r ON u.id_rol = r.id_rol;

CREATE VIEW paciente_por_usuario AS 
SELECT  pa.id_paciente, 
        pa.nombre_paciente, 
        pa.especie_paciente, 
        pa.raza_paciente, 
        pa.sexo_paciente, 
        pa.peso_paciente, 
        pa.color_pelaje_paciente, 
        pa.fecha_nacimiento_paciente, 
        pa.edad_estimada_paciente, 
        pa.rescatado, pa.adoptado, 
        u.nombre_usuario, 
        u.apellido_usuario
FROM paciente_animal pa
JOIN usuarios u ON u.numero_documento = pa.numero_documento;


INSERT INTO `usuarios` (`numero_documento`, `nombre_usuario`, `apellido_usuario`, `tipo_documento_usuario`, `correo_electronico_usuario`, `telefono`, `id_rol`, `contrasena`) 
VALUES
(1000000001, 'Juan', 'Perez', 'CC', 'juanperez@gmail.com', '3110000001', 2, '12345'),
(1000000002, 'Maria', 'Gomez', 'CC', 'mariagomez@gmail.com', '3110000002', 3, '12345'),
(1016102401, 'Duncan Nicolás', 'Hernández Rodriguez', 'CC', 'dnicolas.hr.98@gmail.com', '3144902872', 1, '12345');
